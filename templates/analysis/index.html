{% extends "base.html" %}
{% load static %}
{% block style %}

<link rel="stylesheet" href='{% static "css/toastr.min.css"%}'>
<style>
    .row-fluid .span12 {
        width: 100%;
        margin-left:0px;
        padding:10px;
        background: #f5f7f9;

    }
    .row-fluid .span4 {
        width: 33.3333333333333%;
        margin: 0;
    }

    div.span4 label{text-align:center;height:60px;line-height:60px;color:#fff;border-radius:4px;}
    #visul div.span4 label{font-size:22px}
    h3{text-align:center;}
    .span3{margin: 0;padding: 10px;margin: 0;height:340px;border-radius:10px;background: #ffffff;}
    .chart_pie{width: 350px; height: 280px; margin: 0 auto;float:left;padding-top:20px;padding-bottom:20px;}
    .span9{margin-left:0;border-radius:10px;background: #ffffff;padding:10px}

<!--数据源统计css-->
    /* 本例子css */
    .txtMarquee-top{ width:328px;  overflow:hidden; position:relative; }
    .txtMarquee-top .hd{ overflow:hidden;  height:30px; background:#f4f4f4; padding:0 10px;  }
    .txtMarquee-top .hd .prev,.txtMarquee-top .hd .next{ display:block;  width:9px; height:5px; float:right; margin-right:5px; margin-top:10px;  overflow:hidden;
     cursor:pointer; background:url("../images/arrow.png") 0 -100px no-repeat;}
    .txtMarquee-top .hd .next{ background-position:0 -140px;  }
    .txtMarquee-top .hd .prevStop{ background-position:-60px -100px;  }
    .txtMarquee-top .hd .nextStop{ background-position:-60px -140px;  }
    .txtMarquee-top .bd{ padding:15px;}
    .txtMarquee-top .infoList .tempWrap{height:300px}
    .txtMarquee-top .infoList li{ height:24px; line-height:24px;   }
    .txtMarquee-top .infoList li .date{ float:right; color:#999;  }
</style>

{% endblock %}
{% block info %}
<!--    提示信息-->
<div class="page-header">
    <h4>
        数据可视化统计 <small>支持多数源的数据统计</small>
<!--        <select name="select" style="float:right">-->
<!--            <option value="">请选择一个数据源</option>-->
<!--                <option value="">mce</option>-->
<!--                <option value="">mce</option>-->
<!--                <option value="">mce</option>-->
<!--                <option value="">mce</option>-->
<!--                <option value="">mce</option>-->
<!--                <option value="">mce</option>-->
<!--        </select>-->
    </h4>
</div>
<!--<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>-->
<!--<script src="http://cdn.highcharts.com.cn/highcharts/10.0.0/highcharts.js"></script>-->
<div class="span12">
    <script type="text/javascript" src="{% static 'slidjs/jquery.SuperSlide.2.1.3.js' %}"></script>
    <div class="span3" style="margin: 0;">
        <h4>数据源统计</h4>
            <div style="display:flex;">
                <div style="width:70px;">ID</div>
                <div style="width:125px">数据源</div>
                <div >统计</div>
		    </div>
		<div class="txtMarquee-top">
			<div class="bd">
				<ul class="infoList">
<!--                   <li style="display:flex;"><span style="width:70px">1</span><span style="width:125px">st</span><span>74368</span></li>&ndash;&gt;-->
                </ul>
			</div>
		</div>
<!--        <script type="text/javascript">-->
<!--        加载顺序的问题,需要500ms等待异步加载完成后执行-->
<!--         setTimeout(function(){-->
<!--                    console.log(1);-->
<!--                    jQuery(".txtMarquee-top").slide({mainCell:".bd ul",autoPlay:true,effect:"topMarquee",vis:9,interTime:60,pnLoop:true});-->
<!--                }, 500 )-->
<!--		</script>-->
</div>
    <div class="span9" style="margin: 0 10px 0 10px">
        <div id="pie1" class="chart_pie"></div>
        <div id="pie2" class="chart_pie"></div>
        <div id="pie" class="chart_pie"></div>
    </div>
</div>
<div class="span12" style="background: #ffffff;">
    <h4>数据源数据统计分析</h4>
    <div class="span4" style="background: #88d100;"><label>总数据量:<span id="sum"></span></label></div>
    <div class="span4" style="background: #00ac11;"><label>总新增数据量:<span id="increase"></span></label></div>
    <div class="span4" style="background: #df7366;"><label>总更新数据量:<span id="update"></span></label></div>
</div>
<div class="span12">
    <div id="zhuzhuang" style="min-width:300px;height:800px; margin: 0 auto;"></div>
</div>
<script src='{% static "js/toastr.min.js" %}'></script>
<script>

<!--toastr设置-->
 var toastr;
 toastr.options = {
    closeButton: true,//显示关闭按钮
    debug: false,
    progressBar: true,//显示进度条
    positionClass: "toast-top-center",//位置
    onclick: null,//点击消息框自定义事件
    showDuration: "300",//显示动作时间
    hideDuration: "1000",//隐藏动作时间
    timeOut: "2000",//显示时间,0为永久显示
    extendedTimeOut: "1000",//鼠标移动过后显示显示时间
    showEasing: "swing",
    hideEasing: "linear",
    showMethod: "fadeIn",//显示方式
    hideMethod: "fadeOut"//隐藏方式
 };
<!--获取当前的时间-->
// 格式化日对象
const getNowDate = () => {
  var date = new Date();
  var sign2 = ":";
  var year = date.getFullYear() // 年
  var month = date.getMonth() + 1; // 月
  var day = date.getDate(); // 日
  var hour = date.getHours(); // 时
  var minutes = date.getMinutes(); // 分
  var seconds = date.getSeconds() //秒
  var weekArr = ['星期一', '星期二', '星期三', '星期四', '星期五', '星期六', '星期天'];
  var week = weekArr[date.getDay()];
  // 给一位数的数据前面加 “0”
  if (month >= 1 && month <= 9) {
    month = "0" + month;
  }
  if (day >= 0 && day <= 9) {
    day = "0" + day;
  }
  if (hour >= 0 && hour <= 9) {
    hour = "0" + hour;
  }
  if (minutes >= 0 && minutes <= 9) {
    minutes = "0" + minutes;
  }
  if (seconds >= 0 && seconds <= 9) {
    seconds = "0" + seconds;
  }
  return year + "-" + month + "-" + day + " " + hour + sign2 + minutes + sign2 + seconds;
}


<!--图表设置-->
$(document).ready(function() {
console.log("-------------------------")
$.get('bar_sum/',function(results){
<!--选择属性赋值-->
<!--options_name = results[0].name_list-->
<!--options = ['<option value="">请选择一个数据源</option>']-->
<!--for(var j=0;j<options_name.length;j++){-->
<!--    option='<option value='+options_name[j]+'>'+options_name[j]+'</option>'-->
<!--    options.push(option)-->
<!--}-->
<!--$("select[name='select']").html(options.join(''))-->
<!--柱状图-->
   var chart = {
      type: 'column',
<!--      横屏-->
      inverted:false,
      zoomType: 'x'
   };
   var title = {
      text: '本月数据源更新及新增统计'
   };
   var subtitle = {
      text: getNowDate()
   };
   var xAxis = {
      categories: results[0].name_list,
      crosshair: true
   };
   var yAxis = {
      min: 0,
      title: {
         text: '数据量(个)'
      }
   };
   var tooltip = {
      headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
      pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
         '<td style="padding:0"><b>{point.y:.1f} 个</b></td></tr>',
      footerFormat: '</table>',
      shared: true,
      useHTML: true
   };
   var plotOptions = {
      column: {
         pointPadding: 0.2,
         borderWidth: 0
      }
   };
   var credits = {
      enabled: false
   };

   var series= results[0].data;
    var json = {};
   json.chart = chart;
   json.title = title;
   json.subtitle = subtitle;
   json.tooltip = tooltip;
   json.xAxis = xAxis;
   json.yAxis = yAxis;
   json.series = series;
   json.plotOptions = plotOptions;
   json.credits = credits;
   $('#zhuzhuang').highcharts(json);
})


<!--饼图-->
       var chart = {
           plotBackgroundColor: null,
           plotBorderWidth: null,
           plotShadow: false,
       };

       var tooltip = {
          pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
       };
       var plotOptions = {
          pie: {
             allowPointSelect: true,
             cursor: 'pointer',
             dataLabels: {
                enabled: true,
                format: '<b>{point.name}%</b>: {point.percentage:.1f} %',
                style: {
                   color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
             }
          }
       };
<!--给图表赋值-->
<!--数据源数据量总占比图-->
$.get("pie_sum/",function(data){
<!--                   标题-->
           var title = {
              text: "数据量总占比图"
           };
<!--               子标题-->
           var subtitle= {
                text:getNowDate()
            };
            <!--                组织数据赋值-->
            var series= [{
              type: 'pie',
              name: 'Browser share',
              name: 'Browser share',
              data: data
           }];
           var json = {};
           json.chart = chart;
           json.title = title;
           json.subtitle = subtitle;
           json.tooltip = tooltip;
           json.series = series;
           json.plotOptions = plotOptions;
           $('#pie').highcharts(json);
})

<!--数据源数据量更新总占比图-->
$.get("pie_update/",function(data){
<!--                   标题-->
           var title = {
              text: "数据量更新占比图"
           };
<!--               子标题-->
           var subtitle= {
                text:getNowDate()
            };
            <!--                组织数据赋值-->
            var series= [{
              type: 'pie',
              name: 'Browser share',
              name: 'Browser share',
              data: data
           }];
           var json = {};
           json.chart = chart;
           json.title = title;
           json.subtitle = subtitle;
           json.tooltip = tooltip;
           json.series = series;
           json.plotOptions = plotOptions;
           $('#pie1').highcharts(json);
})
<!--数据源数据量新增总占比图-->
$.get("pie_increase/",function(data){
<!--                   标题-->
           var title = {
              text: "数据量新增占比图"
           };
<!--               子标题-->
           var subtitle= {
                text:getNowDate()
            };
            <!--                组织数据赋值-->
            var series= [{
              type: 'pie',
              name: 'Browser share',
              name: 'Browser share',
              data: data
           }];
           var json = {};
           json.chart = chart;
           json.title = title;
           json.subtitle = subtitle;
           json.tooltip = tooltip;
           json.series = series;
           json.plotOptions = plotOptions;
           $('#pie2').highcharts(json);
})

});
<!--获取本月总的数据量,新增量,更新量-->
$.get("sum_increase_update/",function(results){
    $('#sum').html(results.price_count)
    $('#increase').html(results.query_price_increase_count)
    $('#update').html(results.query_price_update_count)
})
<!--获取本月个数据源的总量-->
$.get("source/",function(results){
    results = results.per_source_count
    var infolist=[]
    for(var i=0;i<results.length;i++){
        li_html = '<li style="display:flex;"><span style="width:70px">'+(i+1)+'</span><span style="width:125px">'+results[i]._id+'</span><span>'+results[i].SourceCount+'</span></li>'
        infolist.push(li_html)
    }
    console.log(infolist)
    $("ul.infoList").html(infolist.join(""))
<!--    # 数据源加载完成之后运行jquery设置-->
    jQuery(".txtMarquee-top").slide({mainCell:".bd ul",autoPlay:true,effect:"topMarquee",vis:9,interTime:60,pnLoop:true});
})
</script>
{% endblock %}